<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HTTP request for Berry, ASYNCIFY=1</title>
    <script type="text/javascript">
        // Code in this SCRIPT tag is extracted from HTML generated by Emscripten
        // https://github.com/emscripten-core/emscripten#license
        var Module = {
            print: (...args) => {
                var text = args.join(' ');
                console.log(text);
            },
            printErr: (x) => {
                console.error(x);
            },
        };

        var filename = './berry.js';

        var worker = new Worker(filename);
        setTimeout(() => {
            worker.postMessage({
                target: 'worker-init',
                URL: document.URL,
                currentScriptUrl: filename,
                preMain: true
            });
        }, 0);

        worker.onmessage = (event) => {
            var data = event.data;
            switch (data.target) {
                case 'stdout': {
                    Module['print'](data.content);
                    break;
                }
                case 'stderr': {
                    Module['printErr'](data.content);
                    break;
                }
                default:
                    throw 'what? ' + data.target;
            }
        }
        worker.postMessage({target: 'gl', op: 'setPrefetched', preMain: true});
    </script>
</head>
<body>
<h2>HTTP Request from inside WASM using Berry-lang and EMSCRIPTEN_FETCH_SYNCHRONOUS with ASYNCIFY enabled</h2>

<p>This example uses native Berry-lang function implemented using
    <code><a
            href="https://emscripten.org/docs/api_reference/fetch.html#synchronous-fetches">emscripten_fetch()</a></code>
    in synchronous mode.</p>
<p>See the output in browser developer console.</p>

<p>Actual code:</p>
<pre>

print(httpget('https://httpbin.org/anything'))

</pre>
<footer><small>Created for (wannabe-awesome) <a href="https://github.com/vasilev/HTTP-request-from-inside-WASM">list</a></small>
</footer>
</body>
</html>
