<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HTTP request for Berry, ASYNCIFY=1</title>
    <script type="text/javascript">
        // Code in this SCRIPT tag is extracted from HTML generated by Emscripten
        // https://github.com/emscripten-core/emscripten#license
        var Module = {
            print: (...args) => {
                var text = args.join(' ');
                console.log(text);
            },
            printErr: (x) => {
                console.error(x);
            },
        };

        var filename = './berry.js';

        var worker = new Worker(filename);
        setTimeout(() => {
            worker.postMessage({
                target: 'worker-init',
                URL: document.URL,
                currentScriptUrl: filename,
                preMain: true
            });
        }, 0);

        worker.onmessage = (event) => {
            var data = event.data;
            switch (data.target) {
                case 'stdout': {
                    Module['print'](data.content);
                    break;
                }
                case 'stderr': {
                    Module['printErr'](data.content);
                    break;
                }
                default:
                    throw 'what? ' + data.target;
            }
        }
        worker.postMessage({target: 'gl', op: 'setPrefetched', preMain: true});
    </script>
</head>
<body>
<h2>HTTP Request from inside WASM using Berry-lang and EMSCRIPTEN_FETCH_SYNCHRONOUS with ASYNCIFY enabled</h2>

<p>This example uses native Berry-lang function implemented using
    <code><a
            href="https://emscripten.org/docs/api_reference/fetch.html#synchronous-fetches">emscripten_fetch()</a></code>
    in synchronous mode.</p>
<p>The <a href="https://github.com/wasm-outbound-http-examples/berry/blob/4e6f6ecd2cfca5fbbd9b7f8539b69540aaf04a29/browser-sync-xhr/main.c">code</a>
    is exactly equal as for <a href="../sync-xhr/">no-Asyncify example</a>. Difference is in compilation option <code>-s ASYNCIFY=1</code>,
    which produces the WASM file 650k bigger.</p>
<p>See the output in browser developer console.</p>

<p>Actual code:</p>
<pre>

print(httpget('https://httpbin.org/anything'))

</pre>
<section>
    <h4>Info</h4>
    <ul>
        <li><a href="https://github.com/wasm-outbound-http-examples/berry/tree/main/browser-sync-xhr-asyncify/">Demo source code</a></li>
        <li>Versions used on the moment of build:<small>
            berry_web: <a href="https://github.com/berry-lang/berry_web/tree/9ebc4e2d0945e6ea5e58daba4bc747a44df5a02c">commit 9ebc4e2d</a>,
            Berry: <a href="https://github.com/berry-lang/berry/tree/fa5d4330a517222934322fff8da3f8401009d550">commit fa5d4330</a>,
            Emscripten: <a href="https://github.com/emscripten-core/emscripten/tree/3.1.69">v3.1.69</a>.
        </small></li>
    </ul>
</section>
<footer><small>Created for (wannabe-awesome) <a href="https://github.com/vasilev/HTTP-request-from-inside-WASM">list</a></small>
</footer>
</body>
</html>
